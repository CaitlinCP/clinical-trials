DROP TABLE IF EXISTS TRIALS_JOINED;

-- -- CREATE CANONICAL TRIALS TO DRUGS TABLE
-- CREATE TABLE CANONICAL SPONSORS AS (
--     SELECT MAX
-- )

CREATE TABLE TRIALS_JOINED AS SELECT 
ti.nct_id
, fda_deduped.BRAND_NAME as INTERVENTION_NAME
, fda_deduped.SPONSOR_NAME

FROM (
    SELECT DISTINCT BRAND_NAME, SPONSOR_NAME FROM FDA_FULL fda
) fda_deduped
INNER JOIN TRIAL_INTERVENTIONS TI on LOWER(fda_deduped.BRAND_NAME) = LOWER(ti.intervention_name);

-- CREATE TABLE TRIALS_UNMATCHED AS SELECT 
-- ti.nct_id
-- FROM TRIALS tr
-- LEFT JOIN TRIALS_JOINED tj on tr.nct_id = tj.nct_id
-- WHERE tj.nct_id IS NULL;